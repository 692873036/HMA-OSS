- name: 改包名+签名（兼容高版本资源）
  run: |
    # 升级APKTool
    wget https://bitbucket.org/iBotPeaches/apktool/downloads/apktool_2.10.0.jar -O /usr/local/bin/apktool.jar
    echo -e '#!/bin/bash\njava -jar /usr/local/bin/apktool.jar "$@"' > /usr/local/bin/apktool
    chmod +x /usr/local/bin/apktool

    # 解包（跳过资源）
    apktool d target.apk -o temp --no-res
    
    # 替换包名
    find temp -type f \( -name "*.smali" -o -name "AndroidManifest.xml" \) | xargs sed -i "s/org\.frknkrc44\.hma_oss/com\.shipook\.reader\.mfxsdq/g; s/Lorg\/frknkrc44\/hma_oss/Lcom\/shipook\/reader\/mfxsdq/g"
    
    # 重打包（跳过资源）
    apktool b temp -o modified.apk --no-res
    
    # 签名对齐
    keytool -genkey -v -keystore k.keystore -alias a -storepass 123456 -keypass 123456 -dname "CN=A"
    jarsigner -sigalg SHA256withRSA -digestalg SHA-256 -keystore k.keystore modified.apk a -storepass 123456
    zipalign -f 4 modified.apk final.apk
